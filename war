#include <stdio.h>
#include <string.h>
#include <stdlib.h>
#include <time.h>

typedef struct {
    char nome[20];
    int dono;        // 1 = Am√©rica do Sul | 2 = Europa
    int exercitos;
} Territorio;

typedef struct {
    char descricao[100];
    int tipo;   // 1 = conquistar continente | 2 = conquistar X territ√≥rios | 3 = ter ex√©rcitos fortes
    int alvo;
} Missao;

// Fun√ß√£o para verificar se o jogador cumpriu sua miss√£o
int verificarMissao(Missao m, Territorio *territorios, int jogador) {
    int i, cont = 0;

    if (m.tipo == 1) { // conquistar continente
        if (m.alvo == 1) { // Am√©rica do Sul
            for (i = 0; i < 3; i++)
                if (territorios[i].dono == jogador) cont++;
            return (cont == 3);
        }
        if (m.alvo == 2) { // Europa
            for (i = 3; i < 6; i++)
                if (territorios[i].dono == jogador) cont++;
            return (cont == 3);
        }
    }

    if (m.tipo == 2) { // conquistar X territ√≥rios
        for (i = 0; i < 6; i++)
            if (territorios[i].dono == jogador) cont++;
        return (cont >= m.alvo);
    }

    if (m.tipo == 3) { // ter ex√©rcitos fortes
        cont = 0;
        for (i = 0; i < 6; i++)
            if (territorios[i].dono == jogador && territorios[i].exercitos >= m.alvo)
                cont++;
        return (cont >= 2);
    }

    return 0;
}

int main() {
    srand(time(NULL));

    Territorio *territorios = (Territorio *) calloc(6, sizeof(Territorio));
    if (territorios == NULL) {
        printf("Erro ao alocar mem√≥ria.\n");
        return 1;
    }

    int i;
    printf("Digite o nome dos 3 pa√≠ses da Am√©rica do Sul:\n");
    for (i = 0; i < 3; i++) {
        printf("Pa√≠s %d: ", i + 1);
        fgets(territorios[i].nome, 20, stdin);
        territorios[i].nome[strcspn(territorios[i].nome, "\n")] = '\0';
        territorios[i].dono = 1;
        territorios[i].exercitos = 5;
    }

    printf("\nDigite o nome dos 3 pa√≠ses da Europa:\n");
    for (i = 3; i < 6; i++) {
        printf("Pa√≠s %d: ", i - 2);
        fgets(territorios[i].nome, 20, stdin);
        territorios[i].nome[strcspn(territorios[i].nome, "\n")] = '\0';
        territorios[i].dono = 2;
        territorios[i].exercitos = 5;
    }

    Missao missoes[4] = {
        {"Conquistar todos os territ√≥rios da Europa", 1, 2},
        {"Conquistar todos os territ√≥rios da Am√©rica do Sul", 1, 1},
        {"Controlar pelo menos 4 territ√≥rios", 2, 4},
        {"Ter pelo menos 2 territ√≥rios com 8 ou mais ex√©rcitos", 3, 8}
    };

    Missao missaoJogador1 = missoes[rand() % 4];
    Missao missaoJogador2 = missoes[rand() % 4];

    printf("\nMiss√£o do Jogador 1: %s\n", missaoJogador1.descricao);
    printf("Miss√£o do Jogador 2: %s\n", missaoJogador2.descricao);

    int opcao;

    while (1) {
        printf("\n===== MAPA =====\n");
        for (i = 0; i < 6; i++) {
            printf("%d. %-12s | Dono: Jogador %d | Ex√©rcitos: %d\n",
                   i + 1, territorios[i].nome, territorios[i].dono, territorios[i].exercitos);
        }

        printf("\n1 - Atacar\n2 - Refor√ßar\n3 - Sair\nEscolha: ");
        scanf("%d", &opcao);

        if (opcao == 3) {
            printf("Saindo do jogo...\n");
            break;
        }

        if (opcao == 2) {
            int pais;
            printf("\nEscolha o n√∫mero do seu territ√≥rio para refor√ßar: ");
            scanf("%d", &pais);
            pais--;

            if (pais >= 0 && pais < 6) {
                territorios[pais].exercitos += 1;
                printf("Voc√™ refor√ßou %s! Agora tem %d ex√©rcitos.\n",
                       territorios[pais].nome, territorios[pais].exercitos);
            } else {
                printf("Territ√≥rio inv√°lido!\n");
            }
        }

        if (opcao == 1) {
            int atacante, defensor;
            printf("\nEscolha o n√∫mero do seu territ√≥rio atacante: ");
            scanf("%d", &atacante);
            atacante--;

            printf("Escolha o n√∫mero do territ√≥rio inimigo: ");
            scanf("%d", &defensor);
            defensor--;

            if (atacante < 0 || atacante >= 6 || defensor < 0 || defensor >= 6) {
                printf("N√∫mero inv√°lido!\n");
                continue;
            }

            if (territorios[atacante].dono == territorios[defensor].dono) {
                printf("Voc√™ n√£o pode atacar um territ√≥rio seu!\n");
                continue;
            }

            if (territorios[atacante].exercitos <= 1) {
                printf("Voc√™ precisa ter mais de 1 ex√©rcito para atacar!\n");
                continue;
            }

            int dadoAtacante = rand() % 6 + 1;
            int dadoDefensor = rand() % 6 + 1;

            printf("\n%s (Jogador %d) tirou %d.\n",
                   territorios[atacante].nome, territorios[atacante].dono, dadoAtacante);
            printf("%s (Jogador %d) tirou %d.\n",
                   territorios[defensor].nome, territorios[defensor].dono, dadoDefensor);

            if (dadoAtacante > dadoDefensor) {
                territorios[defensor].exercitos -= 1;
                printf("Ataque venceu! %s perdeu 1 ex√©rcito.\n", territorios[defensor].nome);

                if (territorios[defensor].exercitos <= 0) {
                    printf("%s foi conquistado!\n", territorios[defensor].nome);
                    territorios[defensor].dono = territorios[atacante].dono;
                    territorios[defensor].exercitos = 1;
                    territorios[atacante].exercitos -= 1;
                }
            } else {
                territorios[atacante].exercitos -= 1;
                printf("Ataque falhou! %s perdeu 1 ex√©rcito.\n", territorios[atacante].nome);
            }
        }

        // üîç Verifica vit√≥ria ap√≥s cada rodada
        if (verificarMissao(missaoJogador1, territorios, 1)) {
            printf("\nüéâ Jogador 1 venceu! Cumpriu a miss√£o: %s\n", missaoJogador1.descricao);
            break;
        }
        if (verificarMissao(missaoJogador2, territorios, 2)) {
            printf("\nüéâ Jogador 2 venceu! Cumpriu a miss√£o: %s\n", missaoJogador2.descricao);
            break;
        }
    }

    free(territorios);
    return 0;
}


